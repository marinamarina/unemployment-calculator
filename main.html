<!DOCTYPE html> 
<html lang="en"> 
<head> 
  <meta charset="utf-8">
  <title>Unemployment Mockup</title>
    <link rel="stylesheet" type="text/css" href="mockup.css" />
    <link rel="stylesheet" type="text/css" href="colorbrewer.css" />
    <style>

        .region:hover { cursor: pointer; }
/*
        .q0-10 { fill:rgb(247,251,255); }
        .q1-10 { fill:rgb(222,235,247); }
        .q2-10 { fill:rgb(198,219,239); }
        .q3-10 { fill:rgb(158,202,225); }
        .q4-10 { fill:rgb(107,174,214); }
        .q5-10 { fill:rgb(66,146,198); }
        .q6-10 { fill:rgb(33,113,181); }
        .q7-10 { fill:rgb(8,81,156); }
        .q8-10 { fill:rgb(8,48,107); }
        .q9-10 { fill:rgb(8,48,107); }
*/
        div#regionName {
            font-size: 18px; font-weight: bold;
            text-align: center;
            color: #444;
            padding-bottom: 12px;
        }

        div#map {
            margin-left: auto;
            margin-right: auto;
            width: 624px;
        }

        .region-label {
            color: #222;    
            font-size: 10px;
        }

    </style>      
</head>
<body>
    <div class="container">
        <div class="header"></div>
        <div class="main">
            <div class="choices">
                <div><img src="choices-header.png"></div>                
                <div class="col">
                    <div class="gender-half off" id="male">
                        <div>Male</div>
                    </div>
                    <div class="gender-half off" id="female">
                        <div>Female</div>
                    </div>
                    <input type="hidden" id="1" value="0">
                </div>
                <div class="col">
                    <select id="s2">
                        <option value="off">Select...</option>
                        <option value="on">London</option>
                    </select>
                    <input type="hidden" id="2" value="0">
                </div>                
                <div class="col">                            
                            <select id="s3" style="margin-bottom: 0px;" placeholder="Select...">                                
                            </select>                        
                    <div id="nav">                        
                        <div id="12"><div class="head">Managers, agriculture & services</div><div class="subhead">Farm managers, Leisure services, Publicans</div></div>
                        <div id="11"><div class="head">Managers</div><div class="subhead">Government officials, Managers</div></div>
                        <div id="23"><div class="head">Teachers & lecturers</div></div>                        
                        <div id="34"><div class="head">Media & sport</div></div>
                        <div id="24"><div class="head">Business/public service profs</div><div class="subhead">Accountants, Lawyers, Librarians, Social work</div></div>
                        <div id="21"><div class="head">Science & tech profs</div><div class="subhead">Dentists, Doctors, Engineers, Vets</div></div>
                        <div id="31"><div class="head">Science/technology assoc profs</div><div class="subhead">IT support, Lab technicians</div></div>                        
			<div id="71"><div class="head">Sales</div><div class="subhead">Retail assistant</div></div>
                        <div id="35"><div class="head">Business/public service assoc profs</div><div class="subhead">Brokers, Estate agents, Train drivers</div></div>                        
			<div id="41"><div class="head">Admin occupations</div><div class="subhead">Civil service, Clerks, Telephonists</div></div>
                        <div id="42"><div class="head">Secretarial</div></div>                        
                        <div id="33"><div class="head">Emergency services</div></div>
                        <div id="51"><div class="head">Skilled agricultural trades</div></div>
                        <div id="82"><div class="head">Transport</div></div>                        
                        <div id="92"><div class="head">Elementary admin/services</div><div class="subhead">Bar/restaurant staff, Postal work, Security guard</div></div>                        
                        <div id="52"><div class="head">Skilled trades</div><div class="subhead">Electricians, Metal workers</div></div>                        
                        <div id="54"><div class="head">Textile, printing, other skilled trades</div></div>                        
                        <div id="53"><div class="head">Skilled building trades</div></div>
                        <div id="61"><div class="head">Caring service occupations</div><div class="subhead">Nursery nurses, childminders</div></div>
                        <div id="62"><div class="head">Leisure</div><div class="subhead">Hairdressers, Travel agents</div></div>                        
			<div id="32"><div class="head">Healthcare associate profs</div><div class="subhead">Nurses, midwives and physios</div></div>
                        <div id="91"><div class="head">Elementary trades</div><div class="subhead">Labourers, Packers</div></div>
                        <div id="72"><div class="head">Customer service, call centres</div></div>                        
                        <div id="81"><div class="head">Plant work</div></div>
                    </div>            
                    <input type="hidden" id="3" value="00">
                </div>
                <div class="clear"></div>
            </div>
            <div class="results">
                <div class="none"><img src="results-none.png"></div>
                <div class="all" style="display: none;">
                    <div class="col"><div id="result1" style="display: none;"><img src="results1.png"></div></div>
                    <div class="col"><div id="result2" style="display: none;"><img src="results2.png"></div></div>                
                    <div class="col"><div id="result3" style="display: none;"><img src="results3.png"></div></div>
                    <div class="clear share" style="display: none;"></div>
                </div>                
            </div>            
            <div class="chart">
                <div class="none"><img src="chart-none.png"></div>         
                <div class="all" style="display: none;"><img src="chart-all.png"></div>
            </div>
            <div id="map"></div>
            <div id="regionName">&nbsp;</div>
        </div>                
    </div>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script> 
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
    <script src="uk-topo.json"></script>
    <script src="all-rates.json"></script>
    <script src="colorbrewer.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {            
            $("select#s2").change(function() {
                var id = parseInt($(this).attr("id").substr(1));                                
                if ($(this).val() == 'on') {
                    $("input#"+id).val(1);
                } else {
                    $("input#"+id).val(0);
                }
                update();
            });

            $("select#s3").click(function(e) {
                $("select#s3").html('');
                e.preventDefault();
                e.stopPropagation(); 
                //$("select#s3").blur();
                $("div#nav").show();
            });

            $("div#nav > div").click(function(e) {                
                $("select#s3").html('');
                $("select#s3").append('<option>'+$("div.head",this).html()+'</option>');
                $("div#nav").hide();
                $("div#nav div.selected").removeClass("selected");
                $(this).addClass("selected");
                $("input#3").val($(this).attr("id"));
                update();
            });

            $("div.gender-half").click(function() {
                var off = $(this).is('.off');
                $("div.gender-half.on").removeClass("on");
                if (off) {
                    $(this).addClass("on");
                    $("input#1").val(1);                    
                }
                update();                
            });
        });

    var width = 624,
        height = 500;

    //var rates = {"South East":0.0316,"London":0.0564,"East of England":0.0385,"North West":0.0599,"South West":0.0335,"West Midlands":0.0643,"East Midlands":0.0484,"Yorkshire & the Humber":0.0634,"Scotland":0.054,"Wales":0.0574,"North East":0.0762,"Northern Ireland":0.0737};

    var quantize = d3.scale.quantize()
        .domain([0.01, 0.4])
        .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

    projection = d3.geo.albers()
        .center([1.55, 53.4])
        .rotate([4.4, 0])
        .parallels([50, 60])
        .scale(1200 * 2)
        .translate([width / 2, height / 2]);    

    var path = d3.geo.path()
        .projection(projection);

    var svg = d3.select("div#map").append("svg")
        .attr("width", width)
        .attr("height", height);

    //console.log(uk);
    var geometries = topojson.object(ukTopo, ukTopo.objects.regions).geometries;

    svg.append("svg:g")
        .attr("class", "regions OrRd")
      .selectAll("path")
        .data(geometries)
      .enter().append("svg:path")
        .attr("d", path)
        .attr("class","region")
        .attr("fill-opacity", 1)
        .attr("class", function (d) { return "region "+quantize(rates["00"][d.properties.name]); } )
        //.attr("class", function (d) { return "region "+getRegion(d.properties.name); } )
        .attr("stroke", "#222")
        .attr("stroke-width", 0.5)        
        .on("mouseover", function(d) {         
            d3.select(this)            
                .attr("stroke-width",1);                
            d3.select("#regionName")
                .html(d.properties.name+" "+(getRate(d.properties.name)*100)+"%"); 
        })
        .on("mouseout", function(d) {
            d3.select(this)            
                .attr("stroke-width",0.6)
                .attr("stroke","#222");
            d3.select("#regionName")
                .html("&nbsp;");
        });

        function getRate(name) {            
            return rates[$("input#3").val()+""][name];
        }

    /* svg.selectAll(".region-label")
        .data(geometries)
      .enter().append("text")
        .attr("class", "region-label")
        .attr("fill", "#222")
        .attr("text-anchor", "middle")
        .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
        .attr("dy", ".35em")
        .text(function(d) { return d.properties.name; }); */

        function update() {
            
            var clicked = [];
            var id = parseInt($(this).attr("id"));                
            
            clicked[id-1] = $(this).val();
            clicked[0] = parseInt($("input#1").val());
            clicked[1] = parseInt($("input#2").val());
            clicked[2] = ($("input3").val() != "00");

            if (clicked[0] || clicked[1] || clicked[2]) {
                
                $("div.all").show();
                $("div.none").hide();
                $("div.all div.col div").hide();
                if (clicked[0]) $("div#result1").show();
                if (clicked[1]) $("div#result2").show();
                if (clicked[2]) $("div#result3").show();

                if (clicked[2]) {                    
                    d3.selectAll(".region").data(geometries).attr("class", function (d) { console.log(d.properties.name); console.log(getRate(d.properties.name)); return "region "+quantize(getRate(d.properties.name)); });
                }

                if (clicked[0] && clicked[1] && clicked[2]) $("div.share").show();
                else $("div.share").hide();

            } else {
                
                $("div.all").hide();                
                $("div.none").show();

            }                
            
        }


    </script>    
</body>
</html>
